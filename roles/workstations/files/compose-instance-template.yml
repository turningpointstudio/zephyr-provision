# Zephyr Instance Template
# Copy this file to create new instances:
#   compose-instance-1.yml (port 3002)
#   compose-instance-2.yml (port 3003)
#   compose-instance-3.yml (port 3004)
# etc.
#
# Remember to:
# 1. Change the 'name' field
# 2. Change HOST_PORT in ports mapping
# 3. Update container names
# 4. Create corresponding .env file (.env.instance-1, .env.instance-2, etc.)
# 5. Update volume names if needed

name: zephyr-instance-X  # CHANGE THIS: instance-1, instance-2, etc.

services:
  mongodb:
    image: mongo:latest
    container_name: mongodb-instance-X  # CHANGE THIS
    ports:
      - "2701X:27017"  # CHANGE THIS: 27011, 27012, 27013, etc.
    volumes:
      - db-data-instance-X:/data/db  # CHANGE THIS
    networks:
      - zephyr-instance-network
      - zephyr-lb-network
    restart: unless-stopped

  zephyr:
    image: zptps/zephyr-desktop:latest
    container_name: zephyr-instance-X  # CHANGE THIS
    depends_on:
      - mongodb
    ports:
      - "300X:3001"  # CHANGE THIS: 3002, 3003, 3004, etc. (maps internal 3001 to host 300X)
    networks:
      - zephyr-instance-network
      - zephyr-lb-network
    restart: unless-stopped
    env_file:
      - .env.instance-X  # CHANGE THIS: .env.instance-1, .env.instance-2, etc.
    environment:
      - MONGO_URI=mongodb://mongodb:27017
      - DOCKER_ENV=true
    volumes:
      - ${EXTERNAL_DELIVERY}:${DELIVERY_FOLDER}
      - ${EXTERNAL_STAGED}:${STAGED_FOLDER}
      - ${EXTERNAL_THUMBNAILS}:${THUMBNAIL_FOLDER}
      - ${EXTERNAL_SYNCLOGS}:${SYNCLOG_FOLDER}
      - ${EXTERNAL_RENDER}:${RENDER_FOLDER}
      - ${EXTERNAL_PROXIES}:${PROXY_FOLDER}
      - ${EXTERNAL_DISGUISE_PROXY_FOLDER}:${DISGUISE_PROXY_FOLDER}

networks:
  zephyr-instance-network:
    driver: bridge
  zephyr-lb-network:
    external: true
    name: zephyr-lb-network

volumes:
  db-data-instance-X:  # CHANGE THIS
